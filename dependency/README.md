 # ä¾èµ–é¡¹åˆå§‹åŒ–å®‰è£…å’Œæ›´æ–°è¯´æ˜æ–‡æ¡£

## **æ ¸å¿ƒåŸåˆ™**

1. **ä¸å¯å˜å®¹å™¨**

    * Docker å®¹å™¨å¯åŠ¨åä¸åº”è¯¥åœ¨å†…éƒ¨é¢‘ç¹ä¿®æ”¹ä¾èµ–/äºŒè¿›åˆ¶ã€‚
    * æ‰€æœ‰æ›´æ–°æœ€å¥½åœ¨ **æ„å»ºé˜¶æ®µ**å®Œæˆï¼Œè¿™æ ·é•œåƒå¯é‡ç°ã€‚

2. **è‡ªåŠ¨åŒ– + å¯å®¡æŸ¥**

    * ä¾èµ–æ›´æ–°åº”è¯¥å¯è¿½è¸ªã€å¯å®¡æŸ¥ï¼Œä¸è¦ç›´æ¥åœ¨è¿è¡Œå®¹å™¨é‡Œæ‹‰å–æœ€æ–°ç‰ˆã€‚

3. **åˆ†å±‚ç®¡ç†**

    * å¯ä»¥æŠŠä¸åŒç±»å‹çš„ä¾èµ–åˆ†å¼€ç®¡ç†ï¼šPython åŒ…ã€äºŒè¿›åˆ¶å·¥å…·ã€Go é¡¹ç›®æœ¬èº«ã€‚

---

## **æ–¹æ¡ˆè®¾è®¡**

### **1ï¸âƒ£ ä¾èµ–å£°æ˜æ–‡ä»¶**

* Python åŒ…ï¼š`requirements.txt`ï¼ˆæˆ– `pyproject.toml`ï¼‰
* äºŒè¿›åˆ¶å¯æ‰§è¡Œæ–‡ä»¶ï¼š`tools.txt` æˆ–ç±»ä¼¼é…ç½®æ–‡ä»¶ï¼Œåˆ—å‡ºå·¥å…·åç§°ã€ç‰ˆæœ¬ã€ä¸‹è½½ URL æˆ– checksum

ä¾‹å¦‚ `tools.txt`ï¼š

```
ffmpeg 6.0 https://ffmpeg.org/releases/ffmpeg-6.0.tar.gz
um 1.2 https://example.com/um-1.2.tar.gz
```

---

### **2ï¸âƒ£ GitHub Actions / CI/CD è‡ªåŠ¨æ›´æ–°**

* **Python åŒ…**ï¼šå®šæœŸæ£€æŸ¥æ›´æ–° â†’ ç”Ÿæˆ PR â†’ å®¡æŸ¥/åˆå¹¶ â†’ æ„å»ºé•œåƒ
* **äºŒè¿›åˆ¶å·¥å…·**ï¼š

    1. å®šæœŸæ£€æŸ¥å·¥å…·ç‰ˆæœ¬ï¼ˆå®˜æ–¹ release API æˆ– hash æ ¡éªŒï¼‰
    2. å¦‚æœæœ‰æ›´æ–° â†’ ç”Ÿæˆ PR æ›´æ–° `tools.txt`
    3. CI/CD æ ¹æ® `tools.txt` ä¸‹è½½å¯¹åº”ç‰ˆæœ¬å¹¶æ‰“åŒ…åˆ°é•œåƒ

è¿™æ ·å¯ä»¥åšåˆ°ï¼š

* æ›´æ–°å¯è¿½è¸ªï¼ˆPR æœ‰è®°å½•ï¼‰
* æ„å»ºé•œåƒå¯é‡ç°
* é¿å…åœ¨è¿è¡Œæ—¶æ‹‰å–äºŒè¿›åˆ¶æ–‡ä»¶

---

### **3ï¸âƒ£ Dockerfile ç¤ºä¾‹**

```dockerfile
FROM golang:1.21

# å®‰è£… Python
RUN apt-get update && apt-get install -y python3 python3-pip wget tar && rm -rf /var/lib/apt/lists/*

WORKDIR /app

# æ‹·è´ä¾èµ–å£°æ˜æ–‡ä»¶
COPY requirements.txt tools.txt ./

# å®‰è£… Python åŒ…
RUN pip install -r requirements.txt

# å®‰è£…äºŒè¿›åˆ¶å·¥å…·
RUN while read name version url; do \
        wget "$url" -O /tmp/$name.tar.gz && \
        tar -xzf /tmp/$name.tar.gz -C /usr/local/bin --strip-components=1; \
    done < tools.txt

# æ‹·è´ Go ä»£ç 
COPY . .

RUN go build -o myapp .

CMD ["./myapp"]
```

> è¿™æ ·åšçš„å¥½å¤„ï¼šPython + äºŒè¿›åˆ¶å·¥å…·å…¨éƒ¨åœ¨ **é•œåƒæ„å»ºé˜¶æ®µå®‰è£…**ï¼Œå¯åŠ¨åä¸ä¿®æ”¹é•œåƒã€‚

---

### **4ï¸âƒ£ è‡ªåŠ¨åŒ–æ›´æ–°æµç¨‹**

1. **å®šæœŸ Action**ï¼š

    * Python åŒ…ï¼š`pip list --outdated` æˆ– Dependabot
    * äºŒè¿›åˆ¶å·¥å…·ï¼šé€šè¿‡ API æ£€æŸ¥æœ€æ–° release
2. **ç”Ÿæˆ PR**ï¼š

    * æ›´æ–° `requirements.txt` / `tools.txt`
3. **CI/CD æ„å»ºé•œåƒ**ï¼š

    * æµ‹è¯•é€šè¿‡åè‡ªåŠ¨å‘å¸ƒæ–°é•œåƒ

---

### **5ï¸âƒ£ ä¼˜ç‚¹**

* é•œåƒ **å¯é‡ç°**ã€**å¯è¿½è¸ª**
* **å•ä¸€æº**ç®¡ç†ä¾èµ–ï¼ˆæ–‡æœ¬æ–‡ä»¶ï¼‰
* æ”¯æŒå¤šç§ç±»å‹ä¾èµ–ï¼ˆPython + äºŒè¿›åˆ¶ï¼‰
* è‡ªåŠ¨åŒ–æ›´æ–°ï¼Œä½†å¯å®¡æŸ¥ï¼Œå®‰å…¨æ€§é«˜

---

ğŸ’¡ **è¿›é˜¶ä¼˜åŒ–**

* å¯¹äºŒè¿›åˆ¶æ–‡ä»¶å¯ç”¨ **checksum æ ¡éªŒ**ï¼Œç¡®ä¿ä¸‹è½½æ­£ç¡®
* å¯ä»¥ç”¨ `Makefile` æˆ–å°è„šæœ¬ç”Ÿæˆ `tools.txt` ç‰ˆæœ¬åˆ—è¡¨
* Python å’ŒäºŒè¿›åˆ¶ä¾èµ–éƒ½å¯ä»¥ç”¨ Dependabot / Renovate ç±»å·¥å…·ç®¡ç†

---

## æµç¨‹æ¦‚è§ˆ

```mermaid
flowchart TD
    A[å®šæœŸè§¦å‘ GitHub Action] --> B[æ£€æŸ¥ Python åŒ…æ›´æ–°]
    A --> C[æ£€æŸ¥äºŒè¿›åˆ¶å·¥å…·æ›´æ–°]
    
    B --> D[ç”Ÿæˆ/æ›´æ–° requirements.txt PR]
    C --> E[ç”Ÿæˆ/æ›´æ–° tools.txt PR]
    
    D --> F[äººå·¥æˆ–è‡ªåŠ¨å®¡æŸ¥åˆå¹¶ PR]
    E --> F
    
    F --> G[CI/CD æ„å»º Docker é•œåƒ]
    
    G --> H[æµ‹è¯•é•œåƒï¼ˆå•å…ƒ/é›†æˆ/å¯æ‰§è¡Œæ–‡ä»¶éªŒè¯ï¼‰]
    
    H --> I[è‡ªåŠ¨å‘å¸ƒæ–°é•œåƒåˆ°é•œåƒä»“åº“]
    
    I --> J[éƒ¨ç½²åˆ°ç”Ÿäº§/æµ‹è¯•ç¯å¢ƒ]
    
    style A fill:#f9f,stroke:#333,stroke-width:2px
    style G fill:#bbf,stroke:#333,stroke-width:2px
    style I fill:#bfb,stroke:#333,stroke-width:2px
```